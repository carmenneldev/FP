import{a as re,b as ae,c as oe,d as le}from"./chunk-M3HRVRGE.js";import{a as me,b as pe}from"./chunk-47TPUHJW.js";import{e as ee,k as te,l as ne,m as ie,n as se,o as de,q as ce}from"./chunk-TKMHLRDS.js";import"./chunk-2CEVVDGB.js";import"./chunk-7ROXXU7J.js";import"./chunk-SY2ZXVJS.js";import"./chunk-POBAOHGX.js";import"./chunk-YY6PKKWH.js";import{e as $,f as H,g as Y,h as Z}from"./chunk-F6E2PCO4.js";import{_ as E,ca as O}from"./chunk-6QB5CJHO.js";import"./chunk-F2X3VGZZ.js";import{B as A,G as j,J as q,N as G,P as J,V as K,W as Q,Z as X,l as F,p as U,q as z,t as R}from"./chunk-W6HB4DVC.js";import{Bb as h,Cb as m,Fb as V,Ka as l,Nb as D,Ob as o,Pb as S,Qb as y,Sb as x,T as b,Tb as v,Ub as T,Vb as B,Wa as P,Wb as L,Z as u,_ as f,a as I,ab as g,b as k,ec as M,gc as w,ib as d,ic as W,mb as N,rb as i,sb as r,tb as p,xb as _}from"./chunk-LWB6VDSI.js";var C={production:!1,apiUrl:"https://4c78b2fc-0624-450f-87fa-d68904955935-00-13oubrciiekpk.worf.replit.dev:3001/api",appName:"Flight Plan",database:{type:"postgresql",ssl:!0,connectionTimeout:15e3,requestTimeout:15e3},azure:{appService:!1,region:"development"},features:{fileUpload:!0,aiAnalysis:!0,realTimeUpdates:!0}};var fe=()=>[10,25,50,100];function he(a,t){if(a&1){let e=_();i(0,"div",17)(1,"div")(2,"h2",18),o(3,"ML Training - Transaction Categorization"),r(),i(4,"p",19),o(5,"Review and categorize transactions to improve the ML model"),r()(),i(6,"p-button",20),h("onClick",function(){u(e);let s=m();return f(s.refreshData())}),r()()}if(a&2){let e=m();l(6),d("loading",e.loading)}}function ye(a,t){if(a&1&&(i(0,"span",21),o(1),r()),a&2){let e=m();l(),y(" (",e.selectedCount," selected)")}}function Ce(a,t){if(a&1){let e=_();i(0,"div",22)(1,"div",23)(2,"div",24)(3,"label",25),o(4,"Bulk Categorize Selected"),r(),i(5,"p-dropdown",26),T("ngModelChange",function(s){u(e);let c=m();return v(c.selectedCategory,s)||(c.selectedCategory=s),f(s)}),r()(),i(6,"div")(7,"p-button",27),h("onClick",function(){u(e);let s=m();return f(s.bulkUpdateCategory())}),r()()()()}if(a&2){let e=m();l(5),d("options",e.categories),x("ngModel",e.selectedCategory),d("showClear",!0),l(2),V("label","Apply to ",e.selectedCount," transactions"),d("disabled",!e.selectedCategory)}}function _e(a,t){a&1&&(i(0,"tr")(1,"th",28),p(2,"p-tableHeaderCheckbox"),r(),i(3,"th"),o(4,"Date"),r(),i(5,"th"),o(6,"Description"),r(),i(7,"th",29),o(8,"Amount"),r(),i(9,"th"),o(10,"Current Category"),r(),i(11,"th"),o(12,"Confidence"),r(),i(13,"th",30),o(14,"Assign Category"),r()())}function xe(a,t){if(a&1&&p(0,"p-tag",35),a&2){let e=m().$implicit,n=m();d("value",e.categoryName)("severity",n.getConfidenceColor(e.confidence))}}function ve(a,t){a&1&&(i(0,"span",37),o(1,"Uncategorized"),r())}function Te(a,t){if(a&1){let e=_();i(0,"tr")(1,"td"),p(2,"p-tableCheckbox",31),r(),i(3,"td"),o(4),M(5,"date"),r(),i(6,"td")(7,"div",32),o(8),r()(),i(9,"td",29)(10,"span",33),o(11),M(12,"number"),r()(),i(13,"td"),g(14,xe,1,2,"p-tag",34)(15,ve,2,0,"ng-template",null,0,W),r(),i(17,"td"),p(18,"p-tag",35),r(),i(19,"td")(20,"p-dropdown",36),h("onChange",function(s){let c=u(e).$implicit,ue=m();return f(ue.updateCategory(c,s.value))}),r()()()}if(a&2){let e=t.$implicit,n=D(16),s=m();l(2),d("value",e),l(2),S(w(5,13,e.date,"MMM d, yyyy")),l(4),S(e.description),l(2),N(e.amount>=0?"text-green-600":"text-red-600"),l(),y(" R",w(12,16,e.amount,"1.2-2")," "),l(3),d("ngIf",e.categoryName)("ngIfElse",n),l(4),d("value",(e.confidence*100).toFixed(0)+"%")("severity",s.getConfidenceColor(e.confidence)),l(2),d("options",s.getCategoryOptions(e))("placeholder",e.categoryName||"Select category")("showClear",!1)}}function be(a,t){if(a&1&&(i(0,"tr")(1,"td",38)(2,"div",39),p(3,"i",40),i(4,"p",41),o(5,"No transactions need categorization!"),r(),i(6,"p",42),o(7),r()()()()),a&2){let e=m();l(7),y("All transactions above ",e.confidenceThreshold," confidence threshold are categorized.")}}var ge=class a{http=b(A);messageService=b(E);transactions=[];categories=[];loading=!1;selectedCategory=null;confidenceThreshold=.5;searchText="";ngOnInit(){this.loadCategories(),this.loadTransactions()}loadCategories(){this.http.get(`${C.apiUrl}/TransactionCategory`).subscribe({next:t=>{this.categories=t.map(e=>k(I({},e),{label:e.name,value:e.id}))},error:t=>{console.error("Error loading categories:",t),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load categories"})}})}loadTransactions(){this.loading=!0,this.http.get(`${C.apiUrl}/BankTransaction/uncategorized`,{params:{confidenceThreshold:this.confidenceThreshold.toString()}}).subscribe({next:t=>{this.transactions=t.map(e=>({id:e.id,date:e.txnDate,description:e.description,amount:e.amount,categoryId:e.categoryId,categoryName:e.categoryName,confidence:e.confidence||0,selected:!1})),this.loading=!1},error:t=>{console.error("Error loading transactions:",t),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load transactions"}),this.loading=!1}})}updateCategory(t,e){e&&this.http.put(`${C.apiUrl}/BankTransaction/${t.id}/category`,{categoryId:e.value,confidence:1}).subscribe({next:()=>{t.categoryId=e.value,t.categoryName=e.label,t.confidence=1,this.messageService.add({severity:"success",summary:"Success",detail:`Transaction categorized as ${e.label}`})},error:n=>{console.error("Error updating category:",n),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update category"})}})}bulkUpdateCategory(){if(!this.selectedCategory){this.messageService.add({severity:"warn",summary:"Warning",detail:"Please select a category first"});return}let t=this.transactions.filter(n=>n.selected);if(t.length===0){this.messageService.add({severity:"warn",summary:"Warning",detail:"Please select at least one transaction"});return}let e=t.map(n=>this.http.put(`${C.apiUrl}/BankTransaction/${n.id}/category`,{categoryId:this.selectedCategory.value,confidence:1}).toPromise());Promise.all(e).then(()=>{t.forEach(n=>{n.categoryId=this.selectedCategory.value,n.categoryName=this.selectedCategory.label,n.confidence=1,n.selected=!1}),this.messageService.add({severity:"success",summary:"Success",detail:`${t.length} transactions updated`}),this.selectedCategory=null}).catch(n=>{console.error("Error bulk updating:",n),this.messageService.add({severity:"error",summary:"Error",detail:"Failed to update some transactions"})})}getConfidenceColor(t){return t>=.8?"success":t>=.5?"warning":"danger"}getCategoryOptions(t){let e=t.amount>=0?"in":"out";return this.categories.filter(n=>!n.directionConstraint||n.directionConstraint===e)}get filteredTransactions(){if(!this.searchText)return this.transactions;let t=this.searchText.toLowerCase();return this.transactions.filter(e=>e.description.toLowerCase().includes(t)||e.categoryName&&e.categoryName.toLowerCase().includes(t))}get selectedCount(){return this.transactions.filter(t=>t.selected).length}refreshData(){this.loadTransactions()}static \u0275fac=function(e){return new(e||a)};static \u0275cmp=P({type:a,selectors:[["app-ml-training"]],features:[B([E])],decls:24,vars:12,consts:[["noCategory",""],[1,"ml-training-container","p-4"],["pTemplate","header"],[1,"grid","mb-4"],[1,"col-12","md:col-6"],["for","search",1,"block","text-900","font-medium","mb-2"],["pInputText","","type","text","id","search","placeholder","Search by description or category...",1,"w-full",3,"ngModelChange","ngModel"],[1,"col-12","md:col-3"],["for","confidence",1,"block","text-900","font-medium","mb-2"],["pInputText","","type","number","id","confidence","min","0","max","1","step","0.1",1,"w-full",3,"ngModelChange","change","ngModel"],[1,"block","text-900","font-medium","mb-2"],[1,"text-900","font-semibold"],["class","text-primary",4,"ngIf"],["class","bulk-update-panel p-3 mb-3 bg-primary-50 border-round",4,"ngIf"],["currentPageReportTemplate","Showing {first} to {last} of {totalRecords} transactions","styleClass","p-datatable-striped","responsiveLayout","scroll",3,"value","loading","paginator","rows","rowsPerPageOptions","showCurrentPageReport"],["pTemplate","body"],["pTemplate","emptymessage"],[1,"flex","justify-content-between","align-items-center","p-3"],[1,"m-0"],[1,"text-sm","text-600","mt-2","mb-0"],["icon","pi pi-refresh","label","Refresh","severity","secondary",3,"onClick","loading"],[1,"text-primary"],[1,"bulk-update-panel","p-3","mb-3","bg-primary-50","border-round"],[1,"flex","gap-3","align-items-end"],[1,"flex-1"],["for","bulkCategory",1,"block","text-900","font-medium","mb-2"],["optionLabel","label","placeholder","Select category","inputId","bulkCategory",1,"w-full",3,"ngModelChange","options","ngModel","showClear"],["icon","pi pi-check",3,"onClick","label","disabled"],[2,"width","3rem"],[2,"text-align","right"],[2,"width","250px"],[3,"value"],[1,"font-medium"],[1,"font-semibold"],[3,"value","severity",4,"ngIf","ngIfElse"],[3,"value","severity"],["optionLabel","label","styleClass","w-full",3,"onChange","options","placeholder","showClear"],[1,"text-500","italic"],["colspan","7",1,"text-center","p-5"],[1,"text-600"],[1,"pi","pi-check-circle","text-4xl","mb-3"],[1,"text-xl"],[1,"text-sm"]],template:function(e,n){e&1&&(i(0,"div",1),p(1,"p-toast"),i(2,"p-card"),g(3,he,7,1,"ng-template",2),i(4,"div",3)(5,"div",4)(6,"label",5),o(7,"Search Transactions"),r(),i(8,"input",6),T("ngModelChange",function(c){return v(n.searchText,c)||(n.searchText=c),c}),r()(),i(9,"div",7)(10,"label",8),o(11,"Confidence Threshold"),r(),i(12,"input",9),T("ngModelChange",function(c){return v(n.confidenceThreshold,c)||(n.confidenceThreshold=c),c}),h("change",function(){return n.loadTransactions()}),r()(),i(13,"div",7)(14,"label",10),o(15,"Stats"),r(),i(16,"div",11),o(17),g(18,ye,2,1,"span",12),r()()(),g(19,Ce,8,6,"div",13),i(20,"p-table",14),g(21,_e,15,0,"ng-template",2)(22,Te,21,19,"ng-template",15)(23,be,8,1,"ng-template",16),r()()()),e&2&&(l(8),x("ngModel",n.searchText),l(4),x("ngModel",n.confidenceThreshold),l(5),y(" ",n.filteredTransactions.length," transactions "),l(),d("ngIf",n.selectedCount>0),l(),d("ngIf",n.selectedCount>0),l(),d("value",n.filteredTransactions)("loading",n.loading)("paginator",!0)("rows",25)("rowsPerPageOptions",L(11,fe))("showCurrentPageReport",!0))},dependencies:[R,F,z,U,X,j,J,q,Q,K,G,ie,ee,O,te,ne,H,$,ae,re,pe,me,Z,Y,de,se,le,oe,ce],encapsulation:2})};export{ge as MlTrainingComponent};
