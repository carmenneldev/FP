import{a as re,b as ne}from"./chunk-5SA2S6GR.js";import{a as Z,b as V,d as ie}from"./chunk-M3HRVRGE.js";import{a as ae}from"./chunk-7T65EUDQ.js";import{a as f}from"./chunk-R26FGQ4L.js";import{d as k,f as H,g as W,h as X}from"./chunk-F6E2PCO4.js";import{a as ee,b as te}from"./chunk-2ZYGBJ4M.js";import{_ as L}from"./chunk-6QB5CJHO.js";import{g as T}from"./chunk-X4I2DCXD.js";import{B as v,G as B,H as l,J as Q,K as R,O as G,Q as z,R as Y,Y as J,_ as K,t as U}from"./chunk-W6HB4DVC.js";import{Bb as N,Cb as j,Ka as s,N as u,Ob as o,Pa as g,S as b,Vb as w,Wa as q,ab as c,f as _,ga as M,ib as S,j as x,nb as p,q as E,rb as r,sb as n,tb as m}from"./chunk-LWB6VDSI.js";var oe=class t{selectedId=new x(null);selectedId$=this.selectedId.asObservable();bankDataSubject=new x(null);bankData$=this.bankDataSubject.asObservable();setSelectedId(e){this.selectedId.next(e)}getSelectedId(){return this.selectedId.value}setBankData(e){this.bankDataSubject.next(e)}static \u0275fac=function(i){return new(i||t)};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};var A=class t{constructor(e){this.http=e}apiUrl=`${f.apiUrl}/Customer`;clientCountSubject=new x(0);clientCount$=this.clientCountSubject.asObservable();getAll(){return new _(e=>{this.http.get(this.apiUrl).subscribe(i=>{this.clientCountSubject.next(i.length),e.next(i),e.complete()})})}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return new _(i=>{this.http.post(this.apiUrl,e).subscribe(a=>{this.refreshClientCount(),i.next(a),i.complete()})})}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,e)}delete(e){return new _(i=>{this.http.delete(`${this.apiUrl}/${e}`).subscribe(()=>{this.refreshClientCount(),i.next(),i.complete()})})}refreshClientCount(){this.getAll().subscribe()}getTransactionSummary(e){return this.http.get(`${this.apiUrl}/${e}/TransactionSummary`)}getStatementTransactions(e){return this.http.get(`${f.apiUrl}/Statements/${e}/Transactions`)}getCustomerTransactions(e,i){let a="";if(i){let d=new URLSearchParams;Object.entries(i).forEach(([h,I])=>{I!==void 0&&d.append(h,I.toString())}),a=d.toString()?`?${d.toString()}`:""}return this.http.get(`${this.apiUrl}/${e}/Transactions${a}`)}static \u0275fac=function(i){return new(i||t)(b(v))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};var F=class t{constructor(e){this.http=e}apiUrl=`${f.apiUrl}/MaritalStatus`;maritalStatuses=[];getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,e)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}static \u0275fac=function(i){return new(i||t)(b(v))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};var O=class t{constructor(e){this.http=e}apiUrl=`${f.apiUrl}/PreferredLanguage`;languages=[];getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,e)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}static \u0275fac=function(i){return new(i||t)(b(v))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};var D=class t{constructor(e){this.http=e}apiUrl=`${f.apiUrl}/Qualification`;qualifications=[];getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,e)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}static \u0275fac=function(i){return new(i||t)(b(v))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};var $=class{static buildForm(e){return e.group({firstName:["",l.required],surname:["",l.required],identityNumber:["",l.required],employer:[""],mobileNumber:["",l.required],emailAddress:["",[l.required,l.email]],physicalAddress1:[""],physicalAddress2:[""],postalCode:[""],provinceID:["",l.required],maritalStatusID:["",l.required],preferredLanguageID:["",l.required],qualificationID:["",l.required],bankStatement:[null]})}static toPayload(e,i){return{financialAdvisorID:i,firstName:e.firstName,surname:e.surname,identityNumber:e.identityNumber,employer:e.employer||"",mobileNumber:e.mobileNumber||"",maritalStatusID:e.maritalStatusID||1,emailAddress:e.emailAddress||"",physicalAddress1:e.physicalAddress1||"",physicalAddress2:e.physicalAddress2||"",provinceID:e.provinceID||0,postalCode:e.postalCode||"",preferredLanguageID:e.preferredLanguageID||0,qualificationID:e.qualificationID||0}}static extractDobFromId(e){if(!/^\d{13}$/.test(e))return null;let i=parseInt(e.slice(0,2),10),a=e.slice(2,4),d=e.slice(4,6),h=new Date().getFullYear()%100,I=i<=h?2e3+i:1900+i;return`${d}-${a}-${I}`}};function fe(t,e){t&1&&(r(0,"p-message",10),o(1,"First name is required."),n())}function be(t,e){t&1&&(r(0,"p-message",10),o(1,"Surname is required."),n())}function ve(t,e){t&1&&(r(0,"p-message",10),o(1,"Identity number is required."),n())}function ge(t,e){t&1&&(r(0,"p-message",10),o(1,"ID must be 13 digits."),n())}function he(t,e){t&1&&(r(0,"p-message",10),o(1,"ID number is not valid."),n())}function Ce(t,e){if(t&1&&c(0,ve,2,0,"p-message",10)(1,ge,2,0,"p-message",10)(2,he,2,0,"p-message",10),t&2){let i,a,d,h=j();p(!((i=h.clientForm.get("identityNumber"))==null||i.errors==null)&&i.errors.required?0:-1),s(),p(!((a=h.clientForm.get("identityNumber"))==null||a.errors==null)&&a.errors.invalidIdFormat?1:-1),s(),p(!((d=h.clientForm.get("identityNumber"))==null||d.errors==null)&&d.errors.invalidIdChecksum?2:-1)}}function Se(t,e){t&1&&(r(0,"p-message",10),o(1,"Mobile number is required."),n())}function ye(t,e){t&1&&(r(0,"p-message",10),o(1,"Email is required."),n())}function Ie(t,e){t&1&&(r(0,"p-message",10),o(1,"Province is required."),n())}function xe(t,e){t&1&&(r(0,"p-message",10),o(1,"Marital status is required."),n())}function _e(t,e){t&1&&(r(0,"p-message",10),o(1,"Preferred language is required."),n())}function Ae(t,e){t&1&&(r(0,"p-message",10),o(1,"Qualification is required."),n())}var le=class t{constructor(e,i,a,d,h,I,Pe,me){this.fb=e;this.clientService=i;this.provinceService=a;this.maritalStatusService=d;this.prefereredLanguageService=h;this.qualificationService=I;this.router=Pe;this.dataCleanerHelper=me;this.provinceService.getAll().subscribe(C=>{this.provinces=this.dataCleanerHelper.stripReferenceProps(C)}),this.maritalStatusService.getAll().subscribe(C=>{this.maritalStatuses=this.dataCleanerHelper.stripReferenceProps(C)}),this.prefereredLanguageService.getAll().subscribe(C=>{this.languages=this.dataCleanerHelper.stripReferenceProps(C)}),this.qualificationService.getAll().subscribe(C=>{this.qualifications=this.dataCleanerHelper.stripReferenceProps(C)}),this.clientForm=this.fb.group({firstName:["",l.required],surname:["",l.required],identityNumber:["",[l.required,me.southAfricanIdValidator]],employer:[""],mobileNumber:["",l.required],emailAddress:["",[l.required,l.email]],physicalAddress1:[null,l.required],physicalAddress2:[""],postalCode:[null,l.required],provinceID:[null,l.required],maritalStatusID:[null,l.required],preferredLanguageID:[null,l.required],qualificationID:[null,l.required]})}close=new M;clientToEdit=null;clientForm;provinces;maritalStatuses;languages;qualifications;isSaving=!1;ngOnInit(){}isInvalid(e){let i=this.clientForm.get(e);return!!(i&&i.invalid&&(i.dirty||i.touched))}onSubmit(){if(this.clientForm.invalid){this.clientForm.markAllAsTouched();return}this.isSaving=!0;let e=parseInt(localStorage.getItem("advisorId")||"0",10),i=$.toPayload(this.clientForm.value,e);console.log("Submitting payload:",i),this.clientService.create(i).subscribe({next:()=>{console.log("Client added successfully"),this.isSaving=!1,this.router.navigate(["/home/clients"]).then(()=>{window.location.reload()}),this.close.emit()},error:a=>{console.error("Error adding client:",a),this.isSaving=!1}})}onFileChange(e){let i=e.target.files[0];i&&this.clientForm.patchValue({bankStatement:i})}static \u0275fac=function(i){return new(i||t)(g(J),g(A),g(ne),g(F),g(O),g(D),g(T),g(ae))};static \u0275cmp=q({type:t,selectors:[["app-add-client-form"]],inputs:{clientToEdit:"clientToEdit"},outputs:{close:"close"},features:[w([L])],decls:90,vars:16,consts:[[1,"overlay"],[1,"popup-form"],[1,"title-container"],[1,"title"],[1,"registrationContainer",3,"ngSubmit","formGroup"],[1,"grid-container"],[1,"flex-container-row"],["variant","on"],["pInputText","","id","firstName","formControlName","firstName","autocomplete","off"],["for","firstName"],["severity","error","size","small","variant","simple"],["pInputText","","id","surname","formControlName","surname","autocomplete","off"],["for","surname"],["pInputText","","id","identityNumber","formControlName","identityNumber","autocomplete","off"],["for","identityNumber"],["pInputText","","id","employer","formControlName","employer","autocomplete","off"],["for","employer"],["pInputText","","id","mobileNumber","formControlName","mobileNumber","autocomplete","off"],["for","mobileNumber"],["pInputText","","id","emailAddress","formControlName","emailAddress","autocomplete","off"],["for","emailAddress"],["pInputText","","id","physicalAddress1","formControlName","physicalAddress1","autocomplete","off"],["for","physicalAddress1"],["pInputText","","id","physicalAddress2","formControlName","physicalAddress2","autocomplete","off"],["for","physicalAddress2"],["pInputText","","id","postalCode","formControlName","postalCode","autocomplete","off"],["for","postalCode"],["id","provinceID","optionLabel","name","optionValue","id","formControlName","provinceID",3,"options"],["for","provinceID"],["id","maritalStatusID","optionLabel","name","optionValue","id","formControlName","maritalStatusID",3,"options"],["for","maritalStatusID"],["id","preferredLanguageID","optionLabel","name","optionValue","id","formControlName","preferredLanguageID",3,"options"],["for","preferredLanguageID"],["id","qualificationID","optionLabel","description","optionValue","id","formControlName","qualificationID",3,"options"],["for","qualificationID"],[1,"flex-container-column","btn-mg-top",2,"min-height","100px","gap","10px"],["pButton","","type","submit","label","Save",1,"btnRegistor","btn-primary",2,"width","100%",3,"disabled","loading"],["pButton","","type","button","label","Cancel",1,"btnCancel",2,"width","100%",3,"click"]],template:function(i,a){i&1&&(r(0,"div",0)(1,"div",1)(2,"div",2)(3,"h3",3),o(4,"Add New Client"),n()(),r(5,"form",4),N("ngSubmit",function(){return a.onSubmit()}),r(6,"div",5)(7,"div",6)(8,"p-floatlabel",7),m(9,"input",8),r(10,"label",9),o(11,"First Name"),n()(),c(12,fe,2,0,"p-message",10),n(),r(13,"div",6)(14,"p-floatlabel",7),m(15,"input",11),r(16,"label",12),o(17,"Surname"),n()(),c(18,be,2,0,"p-message",10),n()(),r(19,"div",5)(20,"div",6)(21,"p-floatlabel",7),m(22,"input",13),r(23,"label",14),o(24,"ID Number"),n()(),c(25,Ce,3,3),n(),r(26,"div",6)(27,"p-floatlabel",7),m(28,"input",15),r(29,"label",16),o(30,"Employer"),n()()()(),r(31,"div",5)(32,"div",6)(33,"p-floatlabel",7),m(34,"input",17),r(35,"label",18),o(36,"Mobile Number"),n()(),c(37,Se,2,0,"p-message",10),n(),r(38,"div",6)(39,"p-floatlabel",7),m(40,"input",19),r(41,"label",20),o(42,"Email Address"),n()(),c(43,ye,2,0,"p-message",10),n()(),r(44,"div",5)(45,"div",6)(46,"p-floatlabel",7),m(47,"input",21),r(48,"label",22),o(49,"Address Line 1"),n()()(),r(50,"div",6)(51,"p-floatlabel",7),m(52,"input",23),r(53,"label",24),o(54,"Address Line 2"),n()()()(),r(55,"div",5)(56,"div",6)(57,"p-floatlabel",7),m(58,"input",25),r(59,"label",26),o(60,"Postal Code"),n()()(),r(61,"div",6)(62,"p-floatlabel",7),m(63,"p-dropdown",27),r(64,"label",28),o(65,"Province"),n()(),c(66,Ie,2,0,"p-message",10),n()(),r(67,"div",5)(68,"div",6)(69,"p-floatlabel",7),m(70,"p-dropdown",29),r(71,"label",30),o(72,"Marital Status"),n()(),c(73,xe,2,0,"p-message",10),n(),r(74,"div",6)(75,"p-floatlabel",7),m(76,"p-dropdown",31),r(77,"label",32),o(78,"Preferred Language"),n()(),c(79,_e,2,0,"p-message",10),n()(),r(80,"div",5)(81,"div",6)(82,"p-floatlabel",7),m(83,"p-dropdown",33),r(84,"label",34),o(85,"Qualification"),n()(),c(86,Ae,2,0,"p-message",10),n()(),r(87,"div",35),m(88,"button",36),r(89,"button",37),N("click",function(){return a.close.emit()}),n()()()()()),i&2&&(s(5),S("formGroup",a.clientForm),s(7),p(a.isInvalid("firstName")?12:-1),s(6),p(a.isInvalid("surname")?18:-1),s(7),p(a.isInvalid("identityNumber")?25:-1),s(12),p(a.isInvalid("mobileNumber")?37:-1),s(6),p(a.isInvalid("emailAddress")?43:-1),s(20),S("options",a.provinces),s(3),p(a.isInvalid("provinceID")?66:-1),s(4),S("options",a.maritalStatuses),s(3),p(a.isInvalid("maritalStatusID")?73:-1),s(3),S("options",a.languages),s(3),p(a.isInvalid("preferredLanguageID")?79:-1),s(4),S("options",a.qualifications),s(3),p(a.isInvalid("qualificationID")?86:-1),s(2),S("disabled",a.clientForm.invalid||a.isSaving)("loading",a.isSaving))},dependencies:[U,re,K,G,B,Q,R,z,Y,X,W,V,Z,H,k,te,ee,ie],styles:[".overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0006;display:flex;justify-content:center;align-items:center;z-index:1000}.popup-form[_ngcontent-%COMP%]{background-color:#fff;padding:2rem;border-radius:12px;width:550px;min-height:650px;box-shadow:0 4px 12px #0000004d}label[_ngcontent-%COMP%]{display:block}input[_ngcontent-%COMP%]{width:100%;padding:.5rem}.popup-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:1rem}.form-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem}.form-group[_ngcontent-%COMP%]{display:flex}.grid-container[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.title-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.flex-container-row-end[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:center;gap:1rem}.registrationContainer[_ngcontent-%COMP%]{max-width:600px;background-color:#fff;display:flex;flex-direction:column;max-height:684px;justify-content:space-evenly;height:100vh}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,1fr);column-gap:10px;position:relative}.flex-container-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}input[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;font-size:13px;outline:none}p-dropdown[_ngcontent-%COMP%]{width:100%}"]})};var se=class t{constructor(e){this.http=e}apiUrl=`${f.apiUrl}/Policy`;policies=[];getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e){return this.http.put(`${this.apiUrl}/${e.id}`,e)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}getByCustomerId(e){return this.getAll().pipe(E(i=>i.filter(a=>a.customerID===e)))}static \u0275fac=function(i){return new(i||t)(b(v))};static \u0275prov=u({token:t,factory:t.\u0275fac,providedIn:"root"})};export{oe as a,A as b,F as c,O as d,D as e,le as f,se as g};
